<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>English Learner</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <style>
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: #667eea;
        overflow: hidden;
        transition: background-color 0.3s ease;
      }
      body {
        padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .app {
        width: 100%;
        max-width: 500px;
        height: 100%;
        background: #fff;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        display: flex;
        flex-direction: column;
      }

      /* Dark Theme */
      body.dark-theme {
        background: #121212;
      }
      body.dark-theme .app {
        background: #1e1e1e;
        color: #ffffff;
      }
      body.dark-theme .content {
        background: #121212;
        color: #ffffff;
      }
      body.dark-theme .word-card,
      body.dark-theme .voice-panel,
      body.dark-theme .settings-item,
      body.dark-theme .question,
      body.dark-theme .uz-word,
      body.dark-theme .result,
      body.dark-theme .opt {
        background: #2d2d2d;
        color: #ffffff;
        border-color: #444;
      }
      body.dark-theme .en {
        color: #6a9eff;
      }
      body.dark-theme .uz {
        color: #cccccc;
      }
      body.dark-theme .pron {
        background: rgba(106, 158, 255, 0.1);
        color: #aaaaaa;
      }
      body.dark-theme .category-btn,
      body.dark-theme .voice-btn,
      body.dark-theme .theme-btn,
      body.dark-theme .opt {
        background: #2d2d2d;
        color: #ffffff;
        border-color: #444;
      }
      body.dark-theme .category-btn.active,
      body.dark-theme .voice-btn.active,
      body.dark-theme .theme-btn.active {
        background: #4a6cf7;
        color: white;
        border-color: #4a6cf7;
      }
      body.dark-theme .score {
        background: #2d3748;
        color: #90cdf4;
      }
      body.dark-theme .progress {
        background: #2d2d2d;
      }
      body.dark-theme .word-counter {
        background: rgba(106, 158, 255, 0.2);
        color: #6a9eff;
      }

      header {
        background: linear-gradient(135deg, #4a6cf7, #6a11cb);
        color: white;
        padding: 20px;
        text-align: center;
        position: relative;
        flex-shrink: 0;
        transition: background 0.3s ease;
      }
      .back-btn {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        background: rgba(255, 255, 255, 0.25);
        border: none;
        color: white;
        width: 44px;
        height: 44px;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        touch-action: manipulation;
      }
      h1 {
        font-size: 22px;
        font-weight: 700;
      }

      /* Screens */
      .screen {
        display: none;
        flex-direction: column;
        height: 100%;
        width: 100%;
      }
      .screen.active {
        display: flex;
      }

      /* Home Screen */
      .home {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 30px 20px;
        gap: 20px;
      }
      .home-btn {
        width: 100%;
        padding: 22px;
        font-size: 18px;
        font-weight: 600;
        color: white;
        background: linear-gradient(135deg, #4a6cf7, #2575fc);
        border: none;
        border-radius: 16px;
        cursor: pointer;
        box-shadow: 0 8px 20px rgba(74, 108, 247, 0.3);
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        touch-action: manipulation;
        min-height: 60px;
      }
      .home-btn:active {
        transform: translateY(4px);
        box-shadow: 0 4px 10px rgba(74, 108, 247, 0.3);
      }

      /* General Content */
      .content {
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        padding: 15px;
        background: #f8f9ff;
      }

      /* Word Memorization */
      .word-card {
        background: white;
        border-radius: 14px;
        padding: 16px;
        margin-bottom: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        border-left: 4px solid #4a6cf7;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }
      .word-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 10px;
      }
      .word-content {
        flex: 1;
      }
      .en {
        font-size: 20px;
        font-weight: bold;
        color: #4a6cf7;
        margin-bottom: 4px;
        line-height: 1.2;
      }
      .uz {
        font-size: 16px;
        color: #333;
        line-height: 1.3;
      }
      .pron {
        font-size: 13px;
        color: #6c757d;
        font-style: italic;
        background: rgba(74, 108, 247, 0.05);
        padding: 4px 8px;
        border-radius: 6px;
        display: inline-block;
        margin-top: 4px;
      }
      .speak-btn {
        background: #4a6cf7;
        color: white;
        border: none;
        padding: 8px 14px;
        border-radius: 10px;
        font-size: 13px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        box-shadow: 0 3px 8px rgba(74, 108, 247, 0.2);
        flex-shrink: 0;
        min-width: 44px;
        height: 40px;
        justify-content: center;
        touch-action: manipulation;
      }

      /* Voice Settings Panel */
      .voice-panel {
        background: white;
        border-radius: 14px;
        padding: 15px;
        margin-bottom: 15px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        border-left: 4px solid #4a6cf7;
      }
      .voice-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .voice-options {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
      }
      .voice-btn {
        padding: 10px 14px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        background: white;
        cursor: pointer;
        font-size: 13px;
        flex: 1;
        min-width: 0;
        text-align: center;
        transition: all 0.2s;
        touch-action: manipulation;
      }
      .voice-btn.active {
        border-color: #4a6cf7;
        background: #4a6cf7;
        color: white;
      }

      /* Category Filter */
      .category-filter {
        display: flex;
        gap: 8px;
        margin-bottom: 15px;
        overflow-x: auto;
        padding: 5px 0;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .category-filter::-webkit-scrollbar {
        display: none;
      }
      .category-btn {
        padding: 8px 14px;
        border: 2px solid #e0e0e0;
        border-radius: 20px;
        background: white;
        cursor: pointer;
        font-size: 13px;
        white-space: nowrap;
        flex-shrink: 0;
        transition: all 0.2s;
        touch-action: manipulation;
      }
      .category-btn.active {
        border-color: #4a6cf7;
        background: #4a6cf7;
        color: white;
      }

      /* Word counter */
      .word-counter {
        text-align: center;
        padding: 6px 12px;
        background: rgba(74, 108, 247, 0.1);
        color: #4a6cf7;
        font-size: 13px;
        font-weight: 600;
        border-radius: 15px;
        margin-bottom: 15px;
        display: inline-block;
      }

      /* Speaking Practice */
      .speaking-center {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        padding: 20px 15px;
        gap: 30px;
      }
      .uz-word {
        font-size: 28px;
        font-weight: bold;
        text-align: center;
        color: #333;
        line-height: 1.3;
        min-height: 70px;
        display: flex;
        align-items: center;
        background: white;
        padding: 20px;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
        border: 2px solid #e9ecef;
        width: 100%;
        max-width: 100%;
        word-break: break-word;
      }
      .hint-btn,
      .mic-btn {
        width: 70px;
        height: 70px;
        border-radius: 50%;
        border: none;
        color: white;
        font-size: 28px;
        cursor: pointer;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        display: flex;
        align-items: center;
        justify-content: center;
        touch-action: manipulation;
      }
      .hint-btn {
        background: #28a745;
      }
      .mic-btn {
        background: #dc3545;
        font-size: 32px;
        width: 90px;
        height: 90px;
      }
      .mic-btn.listening {
        background: #28a745;
        animation: pulse 1.8s infinite;
      }
      @keyframes pulse {
        0% {
          box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
        }
        70% {
          box-shadow: 0 0 0 20px rgba(40, 167, 69, 0);
        }
        100% {
          box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
        }
      }
      .result {
        font-size: 22px;
        font-weight: 600;
        text-align: center;
        min-height: 50px;
        padding: 12px 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 12px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.06);
        border: 2px solid #e9ecef;
        width: 100%;
        word-break: break-word;
      }
      .speaking-categories,
      .quiz-categories {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: 20px;
        padding: 0 10px;
      }

      /* Quiz Screen */
      .score {
        text-align: center;
        padding: 10px;
        background: #e3f2fd;
        color: #1976d2;
        font-weight: 600;
        font-size: 16px;
        border-radius: 0 0 12px 12px;
      }
      .progress {
        height: 4px;
        background: #e0e0e0;
        border-radius: 2px;
        margin: 0;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        background: linear-gradient(135deg, #4a6cf7, #6a11cb);
        border-radius: 2px;
        transition: width 0.3s;
      }
      .question {
        font-size: 28px;
        text-align: center;
        margin: 20px 0;
        font-weight: bold;
        color: #333;
        min-height: 70px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        padding: 15px;
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
        border: 2px solid #e9ecef;
        word-break: break-word;
        line-height: 1.3;
      }
      .options {
        display: grid;
        gap: 12px;
      }
      .opt {
        padding: 18px;
        font-size: 16px;
        background: white;
        border: 2px solid #e0e0e0;
        border-radius: 14px;
        cursor: pointer;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        touch-action: manipulation;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        word-break: break-word;
        line-height: 1.3;
      }
      .opt.correct {
        border-color: #28a745;
        background: #d4edda;
        color: #155724;
      }
      body.dark-theme .opt.correct {
        border-color: #28a745;
        background: #155724;
        color: #d4edda;
      }
      .opt.wrong {
        border-color: #dc3545;
        background: #f8d7da;
        color: #721c24;
      }
      body.dark-theme .opt.wrong {
        border-color: #dc3545;
        background: #721c24;
        color: #f8d7da;
      }
      .next-btn {
        margin: 25px auto;
        padding: 16px 32px;
        background: #4a6cf7;
        color: white;
        border: none;
        border-radius: 12px;
        font-size: 16px;
        cursor: pointer;
        display: block;
        box-shadow: 0 4px 12px rgba(74, 108, 247, 0.3);
        opacity: 1;
        transition: all 0.3s;
        pointer-events: auto;
        touch-action: manipulation;
        min-height: 50px;
      }
      .next-btn.active {
        opacity: 1;
        pointer-events: auto;
      }

      /* Settings Screen */
      .settings-item {
        background: white;
        border-radius: 14px;
        padding: 18px;
        margin-bottom: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
        border-left: 4px solid #4a6cf7;
      }
      .settings-title {
        font-size: 18px;
        font-weight: 600;
        color: #333;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      body.dark-theme .settings-title {
        color: #ffffff;
      }
      .settings-options {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }
      .theme-btn {
        padding: 10px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        background: white;
        cursor: pointer;
        font-size: 14px;
        flex: 1;
        min-width: 100px;
        text-align: center;
        touch-action: manipulation;
      }
      .theme-btn.active {
        border-color: #4a6cf7;
        background: #4a6cf7;
        color: white;
      }
      .color-option {
        width: 36px;
        height: 36px;
        border-radius: 50%;
        cursor: pointer;
        border: 3px solid transparent;
        flex-shrink: 0;
      }
      .color-option.active {
        border-color: #333;
      }
      body.dark-theme .color-option.active {
        border-color: #fff;
      }

      /* Category Selection Screen */
      .category-selection {
        display: none;
        flex-direction: column;
        height: 100%;
        width: 100%;
      }
      .category-selection.active {
        display: flex;
      }
      .category-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        padding: 20px;
      }
      .category-card {
        background: white;
        border-radius: 16px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
        border: 2px solid #e0e0e0;
        transition: all 0.3s;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 100px;
      }
      .category-card:hover {
        transform: translateY(-5px);
        border-color: #4a6cf7;
      }
      .category-icon {
        font-size: 32px;
        color: #4a6cf7;
        margin-bottom: 10px;
      }
      .category-name {
        font-size: 16px;
        font-weight: 600;
        color: #333;
      }
      body.dark-theme .category-card {
        background: #2d2d2d;
        border-color: #444;
      }
      body.dark-theme .category-name {
        color: #fff;
      }

      /* Mobile optimizations */
      @media (max-width: 480px) {
        h1 {
          font-size: 20px;
        }
        .home-btn {
          padding: 18px;
          font-size: 16px;
          min-height: 55px;
        }
        .en {
          font-size: 18px;
        }
        .uz {
          font-size: 15px;
        }
        .question {
          font-size: 24px;
          padding: 12px;
        }
        .opt {
          padding: 16px;
          font-size: 15px;
        }
        .uz-word {
          font-size: 24px;
          padding: 15px;
        }
        .result {
          font-size: 18px;
          padding: 10px 16px;
        }
        .speak-btn {
          padding: 6px 12px;
          font-size: 12px;
          min-width: 40px;
          height: 36px;
        }
        .voice-btn,
        .category-btn,
        .theme-btn {
          padding: 8px 12px;
          font-size: 12px;
        }
        .category-grid {
          grid-template-columns: 1fr;
          gap: 10px;
        }
        .category-card {
          min-height: 80px;
          padding: 15px;
        }
      }
    </style>
  </head>
  <body>
    <div class="app">
      <!-- Home Screen -->
      <div id="home" class="screen active">
        <header><h1>English Learner</h1></header>
        <div class="home">
          <button class="home-btn" onclick="showCategorySelection('memorize')">
            <i class="fas fa-book-open"></i> Word Memorization
          </button>
          <button class="home-btn" onclick="showCategorySelection('quiz')">
            <i class="fas fa-pencil-alt"></i> Practice Quiz
          </button>
          <button class="home-btn" onclick="showCategorySelection('speaking')">
            <i class="fas fa-microphone"></i> Speaking Practice
          </button>
          <button class="home-btn" onclick="showScreen('settings')">
            <i class="fas fa-cog"></i> Settings
          </button>
        </div>
      </div>

      <!-- Category Selection Screen -->
      <div id="categorySelection" class="category-selection">
        <header>
          <button class="back-btn" onclick="showScreen('home')">←</button>
          <h1 id="categoryTitle">Select Category</h1>
        </header>
        <div class="content">
          <div class="category-grid" id="categoryGrid"></div>
        </div>
      </div>

      <!-- Word Memorization Screen -->
      <div id="memorize" class="screen">
        <header>
          <button class="back-btn" onclick="showScreen('home')">←</button>
          <h1>Word Memorization</h1>
        </header>
        <div class="content">
          <!-- Voice Settings Panel -->
          <div class="voice-panel">
            <div class="voice-title">
              <i class="fas fa-volume-up"></i>
              Pronunciation Voice
            </div>
            <div class="voice-options">
              <button class="voice-btn active" onclick="changeVoice('female')">Female</button>
              <button class="voice-btn" onclick="changeVoice('male')">Male</button>
              <button class="voice-btn" onclick="changeVoice('child')">Child</button>
              <button class="voice-btn" onclick="changeVoice('slow')">Slow</button>
            </div>
          </div>
          
          <!-- Category Filter -->
          <div class="category-filter" id="categoryFilter"></div>
          
          <div class="word-counter" id="wordCounter"></div>
          <div id="wordList"></div>
        </div>
      </div>

      <!-- Quiz Screen -->
      <div id="quiz" class="screen">
        <header>
          <button class="back-btn" onclick="showScreen('home')">←</button>
          <h1>Practice Quiz</h1>
        </header>
        <div class="score">
          Score: <span id="scoreValue">0</span> / <span id="totalValue">0</span>
        </div>
        <div class="progress">
          <div class="progress-bar" id="quizProgress" style="width: 0%"></div>
        </div>
        <div class="content">
          <div class="question" id="questionText"></div>
          <div class="options" id="optionsContainer"></div>
          <div class="result" id="feedback"></div>
          <button class="next-btn" id="nextButton" onclick="nextQuestion()">Next →</button>
        </div>
      </div>

      <!-- Speaking Practice Screen -->
      <div id="speaking" class="screen">
        <header>
          <button class="back-btn" onclick="showScreen('home')">←</button>
          <h1>Speaking Practice</h1>
        </header>
        <div class="content" style="padding: 0">
          <div class="speaking-center">
            <div class="uz-word" id="uzWord">Tap the microphone to start</div>
            <div class="result" id="speakingResult"></div>
            <button class="hint-btn" onclick="giveHint()">
              <i class="fas fa-volume-up"></i>
            </button>
            <button class="mic-btn" id="micButton">
              <i class="fas fa-microphone"></i>
            </button>
            <button class="next-btn" id="nextWordButton" onclick="nextSpeakingWord()" style="display: none;">
              Next Word →
            </button>
          </div>
        </div>
      </div>

      <!-- Settings Screen -->
      <div id="settings" class="screen">
        <header>
          <button class="back-btn" onclick="showScreen('home')">←</button>
          <h1>Settings</h1>
        </header>
        <div class="content">
          <!-- Voice Settings -->
          <div class="settings-item">
            <div class="settings-title">
              <i class="fas fa-volume-up"></i>
              Voice Settings
            </div>
            <div class="settings-options">
              <button class="voice-btn active" onclick="changeVoice('female')">Female</button>
              <button class="voice-btn" onclick="changeVoice('male')">Male</button>
              <button class="voice-btn" onclick="changeVoice('child')">Child</button>
              <button class="voice-btn" onclick="changeVoice('slow')">Slow</button>
            </div>
          </div>

          <div class="settings-item">
            <div class="settings-title">
              <i class="fas fa-palette"></i>
              Theme
            </div>
            <div class="settings-options">
              <button class="theme-btn active" onclick="changeTheme('light')">Light</button>
              <button class="theme-btn" onclick="changeTheme('dark')">Dark</button>
            </div>
          </div>

          <div class="settings-item">
            <div class="settings-title">
              <i class="fas fa-fill-drip"></i>
              App Color
            </div>
            <div class="settings-options">
              <div class="color-option active" style="background: #4a6cf7" onclick="changeColor('#4a6cf7')"></div>
              <div class="color-option" style="background: #28a745" onclick="changeColor('#28a745')"></div>
              <div class="color-option" style="background: #dc3545" onclick="changeColor('#dc3545')"></div>
              <div class="color-option" style="background: #ff6b35" onclick="changeColor('#ff6b35')"></div>
              <div class="color-option" style="background: #6f42c1" onclick="changeColor('#6f42c1')"></div>
              <div class="color-option" style="background: #20c997" onclick="changeColor('#20c997')"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Words database with pronunciation and categories
      const words = [
        // --- Adverbs of frequency (Rishlik Ravishlari) ---
        {en:"always", pron:"ˈɔːlweɪz", uz:"har doim", category:"adverbs"},
        {en:"usually", pron:"ˈjuːʒuəli", uz:"odatda", category:"adverbs"},
        {en:"sometimes", pron:"ˈsʌmtaɪmz", uz:"ba'zan", category:"adverbs"},
        {en:"never", pron:"ˈnevər", uz:"hech qachon", category:"adverbs"},

        // --- Daily routine (Kundalik tartib) ---
        {en:"get up", pron:"get ʌp", uz:"uyg'onmoq, turmoq", category:"daily routine"},
        {en:"have a shower", pron:"hæv ə ˈʃaʊər", uz:"dush qilmoq", category:"daily routine"},
        {en:"have breakfast", pron:"hæv ˈbrekfəst", uz:"nonushta qilmoq", category:"daily routine"},
        {en:"go to work", pron:"goʊ tu wɜːrk", uz:"ishga bormoq", category:"daily routine"},
        {en:"go to school", pron:"goʊ tu skuːl", uz:"maktabga bormoq", category:"daily routine"},
        {en:"have lunch", pron:"hæv lʌntʃ", uz:"tushlik qilmoq", category:"daily routine"},
        {en:"have dinner", pron:"hæv ˈdɪnər", uz:"kechki ovqat qilmoq", category:"daily routine"},
        {en:"go to bed", pron:"goʊ tu bed", uz:"uxlashga yotmoq", category:"daily routine"},
        {en:"do housework", pron:"duː ˈhaʊswɜːrk", uz:"uy ishlarini qilmoq", category:"daily routine"},
        {en:"watch TV", pron:"wɒtʃ ˌtiːˈviː", uz:"televizor ko'rmoq", category:"daily routine"},
        {en:"read a newspaper", pron:"riːd ə ˈnjuːzˌpeɪpər", uz:"gazeta o'qimoq", category:"daily routine"},
        {en:"finish work", pron:"ˈfɪnɪʃ wɜːrk", uz:"ishni tugatmoq", category:"daily routine"},
        {en:"go home", pron:"goʊ hoʊm", uz:"uyga bormoq", category:"daily routine"},
        {en:"go shopping", pron:"goʊ ˈʃɒpɪŋ", uz:"do'konga bormoq / xarid qilmoq", category:"daily routine"},
        {en:"have a bath", pron:"hæv ə bɑːθ", uz:"vanna qilmoq", category:"daily routine"},
        {en:"make dinner", pron:"meɪk ˈdɪnər", uz:"kechki ovqat tayyorlamoq", category:"daily routine"},

        // --- Time words (Vaqt so'zlari) ---
        {en:"then", pron:"ðen", uz:"keyin", category:"time"},
        {en:"after", pron:"ˈæftər", uz:"…dan keyin", category:"time"},
        {en:"before", pron:"bɪˈfɔːr", uz:"…dan oldin", category:"time"},
        {en:"in the morning", pron:"ɪn ðə ˈmɔːrnɪŋ", uz:"ertalab", category:"time"},
        {en:"in the afternoon", pron:"ɪn ði ˌæftərˈnuːn", uz:"tushdan keyin", category:"time"},
        {en:"in the evening", pron:"ɪn ði ˈiːvnɪŋ", uz:"kechqurun", category:"time"},
        {en:"at the weekend", pron:"æt ðə ˌwiːkˈend", uz:"hafta oxirida", category:"time"},
        {en:"until", pron:"ənˈtɪl", uz:"…gacha", category:"time"},
        {en:"at about", pron:"æt əˈbaʊt", uz:"taxminan", category:"time"},

        // --- Lesson & reading vocabulary (Dars va o'qish lug'ati) ---
        {en:"hurry", pron:"ˈhʌri", uz:"shoshilmoq", category:"verbs"},
        {en:"towel", pron:"ˈtaʊəl", uz:"sochiq", category:"objects"},
        {en:"floor", pron:"flɔːr", uz:"pol", category:"objects"},
        {en:"clothes", pron:"kloʊðz", uz:"kiyimlar", category:"objects"},
        {en:"steak", pron:"steɪk", uz:"bifshteks, go'sht bo'lagi", category:"food"},
        {en:"ballet", pron:"bæˈleɪ", uz:"balet", category:"arts"},
        {en:"ballet dancer", pron:"ˈbæleɪ ˌdænsər", uz:"balet raqqosi", category:"arts"},
        {en:"sleep", pron:"sliːp", uz:"uyqu, uxlash", category:"verbs"},
        {en:"practise", pron:"ˈpræktɪs", uz:"mashq qilmoq", category:"verbs"},
        {en:"hotel", pron:"hoʊˈtel", uz:"mehmonxona", category:"places"},
        {en:"hungry", pron:"ˈhʌŋɡri", uz:"och", category:"adjectives"},

        // --- /j/ sound (Talaffuz so'zlari) ---
        {en:"yacht", pron:"jɒt", uz:"yaxta", category:"objects"},
        {en:"you", pron:"juː", uz:"sen", category:"pronouns"},
        {en:"your", pron:"jɔːr", uz:"sening", category:"pronouns"},
        {en:"yes", pron:"jes", uz:"ha", category:"interjections"},
        {en:"music", pron:"ˈmjuːzɪk", uz:"musiqa", category:"arts"},
        {en:"beautiful", pron:"ˈbjuːtɪfəl", uz:"chiroyli", category:"adjectives"},
        {en:"student", pron:"ˈstjuːdənt", uz:"talaba", category:"people"},

        // --- Family Members (Oila A'zolari) ---
        {en:"mother", pron:"ˈmʌðər", uz:"ona", category:"family members"},
        {en:"mom", pron:"mɒm", uz:"oyi", category:"family members"},
        {en:"father", pron:"ˈfɑːðər", uz:"ota", category:"family members"},
        {en:"mother-in-law", pron:"ˈmʌðər ɪn lɔː", uz:"qaynona", category:"family members"},
        {en:"father-in-law", pron:"ˈfɑːðər ɪn lɔː", uz:"qaynota", category:"family members"},
        {en:"partner", pron:"ˈpɑːrtnər", uz:"juft / sherik", category:"family members"},
        {en:"dad", pron:"dæd", uz:"dada", category:"family members"},
        {en:"parent", pron:"ˈpeərənt", uz:"ota-ona", category:"family members"},
        {en:"children", pron:"ˈtʃɪldrən", uz:"bolalar", category:"family members"},
        {en:"uncle", pron:"ˈʌŋkl", uz:"tog'a / amaki", category:"family members"},
        {en:"niece", pron:"niːs", uz:"jiyan qiz", category:"family members"},
        {en:"nephew", pron:"ˈnefjuː", uz:"jiyan o'g'il", category:"family members"},
        {en:"grandson", pron:"ˈɡrænsʌn", uz:"nabira o'g'il", category:"family members"},
        {en:"granddaughter", pron:"ˈɡrændɔːtər", uz:"nabira qiz", category:"family members"},
        {en:"grandchild", pron:"ˈɡræntʃaɪld", uz:"nabira", category:"family members"},
        {en:"sister-in-law", pron:"ˈsɪstər ɪn lɔː", uz:"qaynsingil / kelin", category:"family members"},
        {en:"brother-in-law", pron:"ˈbrʌðər ɪn lɔː", uz:"qaynaka / quda", category:"family members"},
        {en:"stepmother", pron:"ˈstepˌmʌðər", uz:"o'gay ona", category:"family members"},
        {en:"stepfather", pron:"ˈstepˌfɑːðər", uz:"o'gay ota", category:"family members"},
        {en:"aunt", pron:"ɑːnt", uz:"xola / amma", category:"family members"},
        {en:"cousin", pron:"ˈkʌzn", uz:"jiyan / qarindosh", category:"family members"},
        {en:"husband", pron:"ˈhʌzbənd", uz:"er", category:"family members"},
        {en:"wife", pron:"waɪf", uz:"xotin / turmush o'rtog'i", category:"family members"},
        {en:"ex", pron:"eks", uz:"sobiq turmush o'rtog'i", category:"family members"},
        {en:"son", pron:"sʌn", uz:"o'g'il", category:"family members"},
        {en:"daughter", pron:"ˈdɔːtər", uz:"qiz", category:"family members"},
        {en:"sister", pron:"ˈsɪstər", uz:"opa-singil", category:"family members"},
        {en:"brother", pron:"ˈbrʌðər", uz:"aka-uka", category:"family members"},
        {en:"grandmother", pron:"ˈɡrænˌmʌðər", uz:"buvi", category:"family members"},
        {en:"grandfather", pron:"ˈɡrænˌfɑːðər", uz:"bobo", category:"family members"},
        {en:"grandparent", pron:"ˈɡrænˌpeərənt", uz:"keksalar / bobo-buvi", category:"family members"},
        
        // --- Question Words (So'roq So'zlari) ---
       
  {en:"what", pron:"", uz:"Nima? / Qanday?", category:"question words"},
  {en:"What is your name?", pron:"", uz:"Isming nima?", category:"question words"},
  {en:"What do you want?", pron:"", uz:"Nimani xohlaysan?", category:"question words"},

  {en:"who", pron:"", uz:"Kim?", category:"question words"},
  {en:"Who is he?", pron:"", uz:"U kim?", category:"question words"},
  {en:"Who called you?", pron:"", uz:"Senga kim qo‘ng‘iroq qildi?", category:"question words"},

  {en:"where", pron:"", uz:"Qayerda? / Qaerga?", category:"question words"},
  {en:"Where do you live?", pron:"", uz:"Qayerda yashaysan?", category:"question words"},
  {en:"Where are they going?", pron:"", uz:"Ular qayerga ketishyapti?", category:"question words"},

  {en:"when", pron:"", uz:"Qachon?", category:"question words"},
  {en:"When is the meeting?", pron:"", uz:"Uchrashuv qachon?", category:"question words"},
  {en:"When did you arrive?", pron:"", uz:"Qachon kelding?", category:"question words"},

  {en:"why", pron:"", uz:"Nima uchun? / Nega?", category:"question words"},
  {en:"Why are you late?", pron:"", uz:"Nega kech kelding?", category:"question words"},
  {en:"Why does she cry?", pron:"", uz:"U nima uchun yig‘layapti?", category:"question words"},

  {en:"which", pron:"", uz:"Qaysi?", category:"question words"},
  {en:"Which book do you want?", pron:"", uz:"Qaysi kitobni xohlaysan?", category:"question words"},
  {en:"Which color is better?", pron:"", uz:"Qaysi rang yaxshiroq?", category:"question words"},

  {en:"whose", pron:"", uz:"Kimniki?", category:"question words"},
  {en:"Whose pen is this?", pron:"", uz:"Bu kimning ruchkasi?", category:"question words"},
  {en:"Whose car is outside?", pron:"", uz:"Tashqaridagi mashina kimniki?", category:"question words"},

  {en:"whom", pron:"", uz:"Kimni? / Kimga?", category:"question words"},
  {en:"Whom did you see?", pron:"", uz:"Kimni ko‘rding?", category:"question words"},
  {en:"Whom are you talking to?", pron:"", uz:"Kim bilan gaplashyapsan?", category:"question words"},

  {en:"how", pron:"", uz:"Qanday? / Qanchalik?", category:"question words"},
  {en:"How are you?", pron:"", uz:"Qalaysiz?", category:"question words"},
  {en:"How does it work?", pron:"", uz:"Bu qanday ishlaydi?", category:"question words"},


  // --- Imperative Sentences (Buyruq Gaplari) ---
  {en:"Come here.", pron:"", uz:"Bu yerga kel.", category:"imperative"},
  {en:"Sit down.", pron:"", uz:"O‘tir.", category:"imperative"},
  {en:"Stand up.", pron:"", uz:"Tur.", category:"imperative"},
  {en:"Open the door.", pron:"", uz:"Eshikni och.", category:"imperative"},
  {en:"Close your book.", pron:"", uz:"Kitobingni yop.", category:"imperative"},
  {en:"Listen to me.", pron:"", uz:"Meni tingla.", category:"imperative"},
  {en:"Don’t talk.", pron:"", uz:"Gapirma.", category:"imperative"},
  {en:"Don’t be late.", pron:"", uz:"Kechikma.", category:"imperative"},
  {en:"Look at the board.", pron:"", uz:"Doskaga qarang.", category:"imperative"},
  {en:"Be quiet.", pron:"", uz:"Jim bo‘l.", category:"imperative"},
  {en:"Write your name.", pron:"", uz:"Ismingni yoz.", category:"imperative"},
  {en:"Turn off the light.", pron:"", uz:"Chiroqni o‘chir.", category:"imperative"},
  {en:"Wait for me.", pron:"", uz:"Meni kut.", category:"imperative"},
  {en:"Don’t worry.", pron:"", uz:"Xavotir olma.", category:"imperative"},
  {en:"Help me.", pron:"", uz:"Menga yordam ber.", category:"imperative"},


// 4-dars


  {en:"drive", pron:"", uz:"haydamoq", category:"4-dars"},
  {en:"driving test", pron:"", uz:"haydovchilik testi", category:"4-dars"},
  {en:"theory exam", pron:"", uz:"nazariy imtihon", category:"4-dars"},
  {en:"practical test", pron:"", uz:"amaliy test", category:"4-dars"},
  {en:"instructor", pron:"", uz:"o‘rgatuvchi", category:"4-dars"},
  {en:"examiner", pron:"", uz:"imtihon oluvchi", category:"4-dars"},
  {en:"lesson", pron:"", uz:"mashg‘ulot, dars", category:"4-dars"},
  {en:"book (a lesson)", pron:"", uz:"darsga yozilmoq", category:"4-dars"},
  {en:"come", pron:"", uz:"kelmoq", category:"4-dars"},
  {en:"listen", pron:"", uz:"tinglamoq", category:"4-dars"},
  {en:"nervous", pron:"", uz:"hayajonlangan", category:"4-dars"},
  {en:"answer", pron:"", uz:"javob bermoq", category:"4-dars"},
  {en:"question", pron:"", uz:"savol", category:"4-dars"},
  {en:"start the car", pron:"", uz:"mashinani ishga tushirmoq", category:"4-dars"},
  {en:"stop on the motorway", pron:"", uz:"trassada to‘xtamoq", category:"4-dars"},
  {en:"no parking sign", pron:"", uz:"to‘xtash taqiqlangan belgisi", category:"4-dars"},
  {en:"traffic lights", pron:"", uz:"svetofor", category:"4-dars"},
  {en:"motorway", pron:"", uz:"katta yo‘l/trassa", category:"4-dars"},
  {en:"early", pron:"", uz:"erta", category:"4-dars"},
  {en:"late", pron:"", uz:"kech", category:"4-dars"},


// 5-dars
{en:"camping", pron:"", uz:"lagerga chiqish, chodir qurib dam olish", category:"5-dars"},
  {en:"buying clothes", pron:"", uz:"kiyim xarid qilish", category:"5-dars"},
  {en:"cooking", pron:"", uz:"ovqat pishirish", category:"5-dars"},
  {en:"cycling", pron:"", uz:"velosiped haydash", category:"5-dars"},
  {en:"flying", pron:"", uz:"uchish (samolyotda)", category:"5-dars"},
  {en:"going to the cinema", pron:"", uz:"kinoga borish", category:"5-dars"},
  {en:"reading", pron:"", uz:"o‘qish", category:"5-dars"},
  {en:"running", pron:"", uz:"yugurish", category:"5-dars"},
  {en:"swimming", pron:"", uz:"suzish", category:"5-dars"},
  {en:"painting", pron:"", uz:"rasm chizish / bo‘yash", category:"5-dars"},
  {en:"travelling", pron:"", uz:"sayohat qilish", category:"5-dars"},
  {en:"watching DVDs", pron:"", uz:"DVD ko‘rish (kino tomosha qilish)", category:"5-dars"},
  {en:"hiking", pron:"", uz:"tog‘larda sayr qilish", category:"5-dars"},
  {en:"dancing", pron:"", uz:"raqsga tushish", category:"5-dars"},
  {en:"fishing", pron:"", uz:"baliq tutish", category:"5-dars"},
  {en:"gardening", pron:"", uz:"bog‘dorchilik qilish", category:"5-dars"},
  {en:"playing the guitar", pron:"", uz:"gitara chalish", category:"5-dars"},
  {en:"playing football", pron:"", uz:"futbol o‘ynash", category:"5-dars"},
  {en:"shopping", pron:"", uz:"xarid qilish", category:"5-dars"},
  {en:"listening to music", pron:"", uz:"musiqa tinglash", category:"5-dars"},
  {en:"drawing", pron:"", uz:"chizmachilik", category:"5-dars"},
  {en:"playing video games", pron:"", uz:"video o‘yin o‘ynash", category:"5-dars"},
  {en:"skiing", pron:"", uz:"chang‘ida uchish", category:"5-dars"},
  {en:"surfing the internet", pron:"", uz:"internetda sayr qilish", category:"5-dars"},
  {en:"taking photos", pron:"", uz:"suratga olish", category:"5-dars"},
  {en:"yoga", pron:"", uz:"yoga bilan shug‘ullanish", category:"5-dars"},
  {en:"baking", pron:"", uz:"pishiriq tayyorlash", category:"5-dars"}

];

      // App state
      let currentWord = null;
      let quizScore = 0;
      let quizTotal = 0;
      let recognition = null;
      let isListening = false;
      let appSettings = {
        theme: "light",
        color: "#4a6cf7",
        voice: "female",
        memorizationCategory: "all",
        quizCategory: "all",
        speakingCategory: "all",
        nextScreen: null
      };

      // Category name mapping with icons
      const categoryInfo = {
        'all': { name: 'All Words', icon: 'fas fa-globe' },
        'adverbs': { name: 'Adverbs', icon: 'fas fa-ad' },
        'daily routine': { name: 'Daily Routine', icon: 'fas fa-calendar-day' },
        'time': { name: 'Time Words', icon: 'fas fa-clock' },
        'verbs': { name: 'Verbs', icon: 'fas fa-running' },
        'objects': { name: 'Objects', icon: 'fas fa-cube' },
        'food': { name: 'Food', icon: 'fas fa-utensils' },
        'arts': { name: 'Arts', icon: 'fas fa-palette' },
        'places': { name: 'Places', icon: 'fas fa-map-marker-alt' },
        'adjectives': { name: 'Adjectives', icon: 'fas fa-font' },
        'pronouns': { name: 'Pronouns', icon: 'fas fa-user' },
        'interjections': { name: 'Interjections', icon: 'fas fa-exclamation' },
        'people': { name: 'People', icon: 'fas fa-users' },
        'family members': { name: 'Family Members', icon: 'fas fa-home' },
        'question words': { name: 'Question Words', icon: 'fas fa-question' }
      };

      // Screen navigation
      function showScreen(screenId) {
        document.querySelectorAll(".screen, .category-selection").forEach((screen) => {
          screen.classList.remove("active");
        });

        const screen = document.getElementById(screenId);
        if (screen) {
          screen.classList.add("active");
        }

        if (screenId === "memorize") {
          loadWords();
        } else if (screenId === "quiz") {
          resetQuiz();
          nextQuestion();
        } else if (screenId === "speaking") {
          nextSpeakingWord();
        }
      }

      // Category selection screen
      function showCategorySelection(nextScreen) {
        appSettings.nextScreen = nextScreen;
        const title = document.getElementById("categoryTitle");
        const grid = document.getElementById("categoryGrid");
        
        if (nextScreen === "memorize") {
          title.textContent = "Select Category for Memorization";
        } else if (nextScreen === "quiz") {
          title.textContent = "Select Category for Quiz";
        } else if (nextScreen === "speaking") {
          title.textContent = "Select Category for Speaking Practice";
        }
        
        // Get unique categories
        const categories = ["all", ...new Set(words.map(word => word.category))];
        
        grid.innerHTML = categories.map(category => `
          <div class="category-card" onclick="selectCategory('${category}')">
            <div class="category-icon">
              <i class="${categoryInfo[category]?.icon || 'fas fa-folder'}"></i>
            </div>
            <div class="category-name">${categoryInfo[category]?.name || category}</div>
          </div>
        `).join('');
        
        showScreen("categorySelection");
      }

      function selectCategory(category) {
        if (appSettings.nextScreen === "memorize") {
          appSettings.memorizationCategory = category;
          showScreen("memorize");
        } else if (appSettings.nextScreen === "quiz") {
          appSettings.quizCategory = category;
          showScreen("quiz");
        } else if (appSettings.nextScreen === "speaking") {
          appSettings.speakingCategory = category;
          showScreen("speaking");
        }
      }

      // Word memorization
      function loadWords() {
        const wordList = document.getElementById("wordList");
        const wordCounter = document.getElementById("wordCounter");
        const categoryFilter = document.getElementById("categoryFilter");
        
        // Create category filter buttons
        const categories = ["all", ...new Set(words.map(word => word.category))];
        categoryFilter.innerHTML = categories.map(category => `
          <button class="category-btn ${category === appSettings.memorizationCategory ? 'active' : ''}" 
                  onclick="filterMemorization('${category}')">
            ${category === 'all' ? 'All Words' : (categoryInfo[category]?.name || category)}
          </button>
        `).join('');
        
        // Filter words by category
        const filteredWords = appSettings.memorizationCategory === "all" 
          ? words 
          : words.filter(word => word.category === appSettings.memorizationCategory);

        wordCounter.textContent = `Showing ${filteredWords.length} words`;
        
        if (filteredWords.length === 0) {
          wordList.innerHTML = '<div class="word-card">No words found in this category.</div>';
          return;
        }

        wordList.innerHTML = filteredWords.map(word => `
          <div class="word-card">
            <div class="word-header">
              <div class="word-content">
                <div class="en">${word.en}</div>
                <div class="uz">${word.uz}</div>
                <div class="pron">/${word.pron}/</div>
              </div>
              <button class="speak-btn" onclick="speakWord('${word.en.replace(/'/g, "\\'")}')">
                <i class="fas fa-volume-up"></i>
              </button>
            </div>
          </div>
        `).join('');
      }

      function filterMemorization(category) {
        appSettings.memorizationCategory = category;
        document.querySelectorAll('#categoryFilter .category-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        loadWords();
      }

      // Voice function
      function speakWord(text) {
        speechSynthesis.cancel();
        
        setTimeout(() => {
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = "en-US";

          switch (appSettings.voice) {
            case "male":
              utterance.rate = 0.9;
              utterance.pitch = 0.7;
              break;
            case "child":
              utterance.rate = 0.8;
              utterance.pitch = 1.5;
              break;
            case "slow":
              utterance.rate = 0.6;
              utterance.pitch = 1.0;
              break;
            default: // female
              utterance.rate = 0.9;
              utterance.pitch = 1.2;
          }

          utterance.volume = 1.0;
          speechSynthesis.speak(utterance);
        }, 100);
      }

      function changeVoice(voice) {
        appSettings.voice = voice;
        
        document.querySelectorAll(".voice-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.textContent.toLowerCase().includes(voice)) {
            btn.classList.add("active");
          }
        });
      }

      // Quiz functionality
      function resetQuiz() {
        quizScore = 0;
        quizTotal = 0;
        document.getElementById("scoreValue").textContent = "0";
        document.getElementById("totalValue").textContent = "0";
        document.getElementById("quizProgress").style.width = "0%";
        document.getElementById("nextButton").style.display = "block";
      }

      function nextQuestion() {
        const nextButton = document.getElementById("nextButton");
        nextButton.style.display = "none";
        document.getElementById("feedback").textContent = "";
        document.getElementById("feedback").style.color = "#333";

        const isEnglishToUzbek = Math.random() < 0.5;
        
        // Filter words by category
        const filteredWords = appSettings.quizCategory === "all" 
          ? words 
          : words.filter(word => word.category === appSettings.quizCategory);
        
        if (filteredWords.length === 0) {
          document.getElementById("questionText").textContent = "No words in this category";
          document.getElementById("optionsContainer").innerHTML = "";
          return;
        }

        const correctWord = filteredWords[Math.floor(Math.random() * filteredWords.length)];

        document.getElementById("questionText").textContent = isEnglishToUzbek
          ? correctWord.en
          : correctWord.uz;

        let options = [correctWord];
        while (options.length < 4) {
          const randomWord = filteredWords[Math.floor(Math.random() * filteredWords.length)];
          if (!options.some((opt) => opt.en === randomWord.en)) {
            options.push(randomWord);
          }
        }

        options.sort(() => Math.random() - 0.5);

        document.getElementById("optionsContainer").innerHTML = options.map((option) => `
          <div class="opt" onclick="selectAnswer(this, '${option.en}', '${correctWord.en}', ${isEnglishToUzbek})">
            ${isEnglishToUzbek ? option.uz : option.en}
          </div>
        `).join("");

        document.getElementById("quizProgress").style.width = `${(quizTotal / 10) * 100}%`;
      }

      function selectAnswer(element, selectedAnswer, correctAnswer, isEnglishToUzbek) {
        quizTotal++;
        document.getElementById("totalValue").textContent = quizTotal;

        if (selectedAnswer === correctAnswer) {
          quizScore++;
          document.getElementById("scoreValue").textContent = quizScore;
          element.classList.add("correct");
          document.getElementById("feedback").textContent = "Correct!";
          document.getElementById("feedback").style.color = "#28a745";
          speakWord(correctAnswer);
        } else {
          element.classList.add("wrong");
          const correctTranslation = isEnglishToUzbek
            ? words.find((w) => w.en === correctAnswer).uz
            : correctAnswer;
          document.getElementById("feedback").textContent = `Correct: ${correctTranslation}`;
          document.getElementById("feedback").style.color = "#dc3545";
          
          document.querySelectorAll(".opt").forEach((opt) => {
            const optText = opt.textContent.trim();
            const correctOptText = isEnglishToUzbek
              ? words.find((w) => w.en === correctAnswer).uz
              : correctAnswer;
            if (optText === correctOptText) {
              opt.classList.add("correct");
            }
          });
        }

        document.querySelectorAll(".opt").forEach((opt) => {
          opt.style.pointerEvents = "none";
        });

        document.getElementById("nextButton").style.display = "block";
        document.getElementById("quizProgress").style.width = `${(quizTotal / 10) * 100}%`;
      }

      // Speaking practice - TO'G'IRLANGAN
      let currentSpeakingWords = [];
      let speakingIndex = 0;

      function nextSpeakingWord() {
        const filteredWords = appSettings.speakingCategory === "all" 
          ? words 
          : words.filter(word => word.category === appSettings.speakingCategory);
        
        if (filteredWords.length === 0) {
          document.getElementById("uzWord").textContent = "No words in this category";
          document.getElementById("speakingResult").textContent = "";
          document.getElementById("nextWordButton").style.display = "none";
          return;
        }

        // Yangi so'z tanlash
        currentWord = filteredWords[Math.floor(Math.random() * filteredWords.length)];

        document.getElementById("uzWord").textContent = currentWord.uz;
        document.getElementById("speakingResult").textContent = "Tap microphone and say the word";
        document.getElementById("speakingResult").style.color = "#333";
        document.getElementById("micButton").classList.remove("listening");
        document.getElementById("nextWordButton").style.display = "none";

        if (recognition) {
          try {
            recognition.stop();
          } catch (e) {}
        }
        isListening = false;
      }

      function giveHint() {
        if (currentWord) {
          speakWord(currentWord.en);
        }
      }

      // Microphone functionality - TO'G'IRLANGAN
      document.getElementById("micButton").addEventListener("click", function () {
        if (isListening) {
          stopListening();
          return;
        }
        startListening();
      });

      function startListening() {
        if (!("webkitSpeechRecognition" in window) && !("SpeechRecognition" in window)) {
          alert("Speech recognition is not supported in your browser. Please use Chrome or Edge.");
          return;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = "en-US";
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;

        recognition.onstart = function () {
          isListening = true;
          document.getElementById("micButton").classList.add("listening");
          document.getElementById("speakingResult").textContent = "Listening... Speak now";
          document.getElementById("speakingResult").style.color = "#333";
        };

        recognition.onresult = function (event) {
          const result = event.results[0][0];
          const spokenText = result.transcript.trim().toLowerCase();
          const correctAnswer = currentWord.en.toLowerCase();
          
          console.log("Spoken:", spokenText);
          console.log("Correct:", correctAnswer);
          
          // Kengaytirilgan tekshirish
          let isCorrect = false;
          
          // 1. Aniq mos kelish
          if (spokenText === correctAnswer) {
            isCorrect = true;
          }
          // 2. Harflarni almashtirish (e.g., "wat" for "what")
          else if (levenshteinDistance(spokenText, correctAnswer) <= 2) {
            isCorrect = true;
          }
          // 3. So'zlar bo'yicha tekshirish
          else {
            const spokenWords = spokenText.split(/\s+/);
            const correctWords = correctAnswer.split(/\s+/);
            
            if (spokenWords.length === correctWords.length) {
              let matchCount = 0;
              for (let i = 0; i < spokenWords.length; i++) {
                if (levenshteinDistance(spokenWords[i], correctWords[i]) <= 1) {
                  matchCount++;
                }
              }
              isCorrect = matchCount / correctWords.length >= 0.8;
            }
          }

          if (isCorrect) {
            document.getElementById("speakingResult").textContent = "✅ Perfect! Correct pronunciation!";
            document.getElementById("speakingResult").style.color = "#28a745";
            speakWord("Excellent!");
            
            // 2 sekunddan keyin yangi so'z
            setTimeout(() => {
              nextSpeakingWord();
            }, 2000);
          } else {
            document.getElementById("speakingResult").textContent = `❌ Try again. You said: "${spokenText}"`;
            document.getElementById("speakingResult").style.color = "#dc3545";
            
            // Qayta urinish uchun ruxsat
            setTimeout(() => {
              document.getElementById("speakingResult").textContent = "Try again. Tap microphone";
              isListening = false;
              document.getElementById("micButton").classList.remove("listening");
            }, 2000);
          }
        };

        recognition.onerror = function (event) {
          console.log("Speech recognition error:", event.error);
          if (event.error === "no-speech") {
            document.getElementById("speakingResult").textContent = "No speech detected. Try again.";
          } else if (event.error === "audio-capture") {
            document.getElementById("speakingResult").textContent = "No microphone found.";
          } else if (event.error === "not-allowed") {
            document.getElementById("speakingResult").textContent = "Microphone permission denied.";
          } else {
            document.getElementById("speakingResult").textContent = "Error occurred. Try again.";
          }
          document.getElementById("speakingResult").style.color = "#dc3545";
          stopListening();
        };

        recognition.onend = function () {
          stopListening();
        };

        try {
          recognition.start();
        } catch (error) {
          console.log("Recognition start error:", error);
          document.getElementById("speakingResult").textContent = "Error starting recognition";
          document.getElementById("speakingResult").style.color = "#dc3545";
          isListening = false;
          document.getElementById("micButton").classList.remove("listening");
        }
      }

      // Levenshtein distance for better matching
      function levenshteinDistance(a, b) {
        if (a.length === 0) return b.length;
        if (b.length === 0) return a.length;

        const matrix = [];

        for (let i = 0; i <= b.length; i++) {
          matrix[i] = [i];
        }

        for (let j = 0; j <= a.length; j++) {
          matrix[0][j] = j;
        }

        for (let i = 1; i <= b.length; i++) {
          for (let j = 1; j <= a.length; j++) {
            if (b.charAt(i - 1) === a.charAt(j - 1)) {
              matrix[i][j] = matrix[i - 1][j - 1];
            } else {
              matrix[i][j] = Math.min(
                matrix[i - 1][j - 1] + 1,
                matrix[i][j - 1] + 1,
                matrix[i - 1][j] + 1
              );
            }
          }
        }

        return matrix[b.length][a.length];
      }

      function stopListening() {
        if (recognition) {
          try {
            recognition.stop();
          } catch (e) {}
        }
        isListening = false;
        document.getElementById("micButton").classList.remove("listening");
      }

      // Settings functions
      function changeTheme(theme) {
        appSettings.theme = theme;
        
        document.querySelectorAll(".theme-btn").forEach((btn) => {
          btn.classList.remove("active");
          if (btn.textContent.toLowerCase().includes(theme)) {
            btn.classList.add("active");
          }
        });

        if (theme === "dark") {
          document.body.classList.add("dark-theme");
          document.body.style.background = "#121212";
        } else {
          document.body.classList.remove("dark-theme");
          document.body.style.background = "#667eea";
        }
      }

      function changeColor(color) {
        appSettings.color = color;
        
        document.querySelectorAll(".color-option").forEach((opt) => opt.classList.remove("active"));
        event.target.classList.add("active");

        const darkColor = darkenColor(color, 20);
        document.querySelectorAll("header").forEach((header) => {
          header.style.background = `linear-gradient(135deg, ${color}, ${darkColor})`;
        });
        
        document.querySelectorAll(".speak-btn, .home-btn, .next-btn, .hint-btn, .mic-btn").forEach((btn) => {
          btn.style.background = color;
        });
        
        document.querySelectorAll(".word-card, .voice-panel, .settings-item, .progress-bar").forEach((el) => {
          el.style.borderLeftColor = color;
        });
        
        document.querySelectorAll(".voice-btn.active, .theme-btn.active, .category-btn.active").forEach((btn) => {
          btn.style.background = color;
          btn.style.borderColor = color;
        });
      }

      function darkenColor(color, percent) {
        const num = parseInt(color.replace("#", ""), 16);
        const amt = Math.round(2.55 * percent);
        const R = (num >> 16) - amt;
        const G = ((num >> 8) & 0x00ff) - amt;
        const B = (num & 0x0000ff) - amt;
        return "#" + (
          0x1000000 +
          (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +
          (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +
          (B < 255 ? (B < 1 ? 0 : B) : 255)
        ).toString(16).slice(1);
      }

      // Initialize the app
      window.onload = function () {
        loadWords();
      };
    </script>
  </body>
</html>